# Идея: редактирование количества в приходе и передаче с сохранением истории

## Цель
Добавить возможность исправлять количество в уже сохранённых записях `Приход НЗП` и `Передача НЗП` без потери трассировки изменений.

## Предложение по реализации
1. **Не изменять запись «в лоб»**: каждое редактирование выполнять как новую версию через audit-таблицы.
2. **Показывать историю версий в UI**:
   - исходное количество;
   - новое количество;
   - кто и когда изменил;
   - комментарий причины изменения.
3. **Откат по версии**:
   - для прихода — использовать уже существующий подход с `VersionId`;
   - для передачи — аналогичный механизм поверх `TransferAudit`.
4. **Валидация при редактировании**:
   - нельзя ставить количество меньше 0;
   - для передачи нельзя превышать доступный остаток на операции «до»;
   - если есть ярлык, количество редактирования должно согласовываться с количеством ярлыка.
5. **Прозрачность в карточках истории**:
   - отдельный признак, что запись была изменена;
   - быстрый переход в модальное окно «История изменений».

## Минимальный UX-поток
1. В таблице истории кнопка **«Изменить количество»**.
2. Открывается модальное окно с текущим количеством и полем нового количества + комментарием.
3. После сохранения создаётся новая версия, остатки пересчитываются, в журнале появляется строка изменения.
4. При необходимости доступен откат к любой версии.
